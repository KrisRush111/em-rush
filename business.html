<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Raccoon Clicker - Бизнес</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .progress-bar {
            height: 20px;
            transition: width 0.3s ease;
        }
        .business-item {
            transition: all 0.2s ease;
        }
        .business-item:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }
        .modal {
            transition: all 0.3s ease;
            opacity: 0;
            visibility: hidden;
        }
        .modal.active {
            opacity: 1;
            visibility: visible;
        }
        .business-card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }
        .business-card:hover {
            box-shadow: 0 14px 28px rgba(0, 0, 0, 0.1), 0 10px 10px rgba(0, 0, 0, 0.05);
            transform: translateY(-5px);
        }
        .animate-slide-in {
            animation: slideIn 0.5s ease-out forwards;
        }
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .delay-100 {
            animation-delay: 0.1s;
        }
        .delay-200 {
            animation-delay: 0.2s;
        }
        .delay-300 {
            animation-delay: 0.3s;
        }
        .currency-icon {
            display: inline-block;
            width: 16px;
            height: 16px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path fill="%23f59e0b" d="M12,2C6.48,2,2,6.48,2,12s4.48,10,10,10s10-4.48,10-10S17.52,2,12,2z M12,20c-4.41,0-8-3.59-8-8s3.59-8,8-8 s8,3.59,8,8S16.41,20,12,20z M12,6c-3.31,0-6,2.69-6,6s2.69,6,6,6s6-2.69,6-6S15.31,6,12,6z M12,16c-2.21,0-4-1.79-4-4 s1.79-4,4-4s4,1.79,4,4S14.21,16,12,16z"/><path fill="%23f59e0b" d="M12,10c-1.1,0-2,0.9-2,2s0.9,2,2,2s2-0.9,2-2S13.1,10,12,10z"/></svg>');
            background-size: contain;
            margin-right: 4px;
        }
        .level-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: bold;
            z-index: 10;
        }
        .nav-footer {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: white;
            box-shadow: 0 -2px 10px rgba(0,0,0,0.1);
            z-index: 100;
            backdrop-filter: blur(10px);
            background-color: rgba(255, 255, 255, 0.8);
        }
        .nav-item {
            transition: all 0.2s ease;
        }
        .nav-item:hover {
            transform: translateY(-5px);
        }
        .nav-item.active {
            color: #3B82F6;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .notification {
            animation: fadeIn 0.3s ease-out;
        }
        .progress-container {
            background: rgba(229, 231, 235, 0.5);
            border-radius: 10px;
            overflow: hidden;
        }
        .progress-fill {
            background: linear-gradient(90deg, #3B82F6, #60A5FA);
            height: 100%;
            transition: width 0.5s ease;
        }
        .counter {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 12px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            backdrop-filter: blur(5px);
        }
        .game-container {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.05);
            backdrop-filter: blur(10px);
        }
        .pulse-button {
            animation: pulse-glow 2s infinite;
        }
        @keyframes pulse-glow {
            0% {
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.7);
            }
            70% {
                box-shadow: 0 0 0 10px rgba(59, 130, 246, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(59, 130, 246, 0);
            }
        }
    </style>
</head>

<body class="min-h-screen flex flex-col" oncontextmenu="return false;">
    <!-- Основной контейнер игры -->
    <div id="game-container" class="container mx-auto px-4 py-8 flex-grow mb-16">
        <div class="flex flex-col">
            <!-- Основная игровая область -->
            <div class="flex-1">
                <div class="game-container bg-white/90 rounded-xl p-6 shadow-lg relative">
                    <!-- Бейдж уровня -->
                    <div id="level-badge" class="level-badge animate-slide-in">
                        Уровень <span id="current-level">1</span>
                    </div>
                    
                    <div class="flex justify-between items-center mb-6">
                        <div class="counter bg-blue-100/80 text-blue-800 px-4 py-2 rounded-full font-semibold">
                            <span class="currency-icon"></span>
                            <span id="coins">0</span> RCC
                        </div>
                        <div class="counter bg-green-100/80 text-green-800 px-4 py-2 rounded-full font-semibold">
                            <i class="fas fa-bolt mr-2"></i>
                            <span id="cps">0</span> RCC/15 сек
                        </div>
                    </div>

                    <div class="mb-6">
                        <div class="flex justify-between mb-2">
                            <span class="text-sm font-medium text-gray-700">Прогресс до следующего уровня</span>
                            <span class="text-sm font-medium text-gray-700"><span id="current-progress">0</span>/<span id="target">10000</span> RCC</span>
                        </div>
                        <div class="progress-container w-full bg-gray-200/50 rounded-full h-3">
                            <div id="progress-bar" class="progress-fill rounded-full h-3" style="width: 0%"></div>
                        </div>
                    </div>

                    <div class="bg-blue-50/80 border border-blue-200 rounded-lg p-4 mb-6 animate-slide-in delay-100">
                        <div class="flex items-center">
                            <div class="flex-shrink-0 text-blue-500">
                                <i class="fas fa-info-circle text-xl"></i>
                            </div>
                            <div class="ml-3">
                                <h3 class="text-sm font-medium text-blue-800">Бизнес-совет</h3>
                                <div class="mt-1 text-sm text-blue-700">
                                    <p>Покупайте культурные заведения, чтобы получать пассивный доход!</p>
                                    <p class="mt-1">Доход от бизнеса добавляется к вашему общему доходу RCC/15 сек.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Бизнес-секция -->
            <div class="mt-8">
                <div class="game-container bg-white/90 rounded-xl p-6 shadow-lg">
                    <div class="flex justify-between items-center mb-6">
                        <h2 class="text-xl font-bold text-gray-800 flex items-center animate-slide-in">
                            <i class="fas fa-business-time mr-3 text-green-500"></i> Ваши заведения
                        </h2>
                        <button id="open-business-modal" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg font-medium transition pulse-button">
                            <i class="fas fa-plus mr-2"></i> Открыть бизнес
                        </button>
                    </div>

                    <div id="business-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <!-- Бизнесы будут добавляться динамически -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Модальное окно покупки бизнеса -->
    <div id="business-modal" class="modal fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
        <div class="bg-white rounded-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-xl font-bold text-gray-800">Купить бизнес</h3>
                <button id="close-modal" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>

            <div id="business-offers" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- Предложения бизнеса будут добавляться динамически -->
            </div>
        </div>
    </div>

    <!-- Футер с навигацией -->
    <footer class="nav-footer">
        <div class="container mx-auto px-4 py-3">
            <div class="flex justify-around">
                <!-- Меню -->
                <a href="menu.html" class="nav-item flex flex-col items-center text-gray-600 hover:text-blue-500">
                    <i class="fas fa-bars text-2xl mb-1"></i>
                    <span class="text-xs">Меню</span>
                </a>
                
                <!-- Бизнес -->
                <a href="business.html" class="nav-item flex flex-col items-center text-green-500">
                    <i class="fas fa-business-time text-2xl mb-1"></i>
                    <span class="text-xs">Бизнес</span>
                </a>
                
                <!-- Достижения -->
                <a href="achievements.html" class="nav-item flex flex-col items-center text-gray-600 hover:text-yellow-500">
                    <i class="fas fa-trophy text-2xl mb-1"></i>
                    <span class="text-xs">Достижения</span>
                </a>
                
                <!-- Настройки -->
                <a href="settings.html" class="nav-item flex flex-col items-center text-gray-600 hover:text-purple-500">
                    <i class="fas fa-cog text-2xl mb-1"></i>
                    <span class="text-xs">Настройки</span>
                </a>
            </div>
        </div>
    </footer>

    <script>
        // Глобальные переменные игры
        let coins = 0;
        let cps = 0;
        let currentTarget = 10000;
        let currentLevel = 1;
        let isFinalLevel = false;
        const tabId = Date.now() + '-' + Math.random().toString(36).substr(2, 9);
        let lastSaveTime = Date.now();

        // Цели для уровней (только 6 уровней)
        const levelTargets = [
            10000,    // Уровень 1
            100000,   // Уровень 2
            500000,   // Уровень 3
            10000000,  // Уровень 4
            50000000,  // Уровень 5
            1000000000  // Уровень 6 (последний)
        ];

        // Бизнесы (культурные заведения)
        const businesses = {
            // Уровень 1
            cinema: {
                name: "Кинотеатр",
                icon: "fas fa-film",
                color: "bg-purple-100 text-purple-600",
                basePrice: 5000,
                baseIncome: 10,
                description: "Показывает фильмы и собирает RCC с посетителей.",
                owned: 0,
                price: 5000
            },
            museum: {
                name: "Музей",
                icon: "fas fa-landmark",
                color: "bg-blue-100 text-blue-600",
                basePrice: 10000,
                baseIncome: 20,
                description: "Выставляет экспонаты и привлекает туристов.",
                owned: 0,
                price: 10000
            },
            
            // Уровень 2
            theater: {
                name: "Театр",
                icon: "fas fa-theater-masks",
                color: "bg-red-100 text-red-600",
                basePrice: 50000,
                baseIncome: 50,
                description: "Ставит спектакли и собирает RCC с зрителей.",
                owned: 0,
                price: 50000,
                minLevel: 2
            },
            
            // Уровень 3
            concertHall: {
                name: "Концертный зал",
                icon: "fas fa-music",
                color: "bg-yellow-100 text-yellow-600",
                basePrice: 200000,
                baseIncome: 100,
                description: "Организует концерты и музыкальные мероприятия.",
                owned: 0,
                price: 200000,
                minLevel: 3
            },
            artGallery: {
                name: "Художественная галерея",
                icon: "fas fa-palette",
                color: "bg-pink-100 text-pink-600",
                basePrice: 500000,
                baseIncome: 150,
                description: "Выставляет картины и продает билеты на выставки.",
                owned: 0,
                price: 500000,
                minLevel: 3
            },
            
            // Уровень 4
            opera: {
                name: "Оперный театр",
                icon: "fas fa-archway",
                color: "bg-indigo-100 text-indigo-600",
                basePrice: 2000000,
                baseIncome: 500,
                description: "Ставит оперные спектакли мирового уровня.",
                owned: 0,
                price: 2000000,
                minLevel: 4
            },
            
            // Уровень 5
            amusementPark: {
                name: "Парк развлечений",
                icon: "fas fa-ferris-wheel",
                color: "bg-green-100 text-green-600",
                basePrice: 10000000,
                baseIncome: 1000,
                description: "Развлекательный комплекс с аттракционами.",
                owned: 0,
                price: 10000000,
                minLevel: 5
            },
            
            // Уровень 6
            culturalComplex: {
                name: "Культурный комплекс",
                icon: "fas fa-monument",
                color: "bg-gray-100 text-gray-600",
                basePrice: 50000000,
                baseIncome: 5000,
                description: "Грандиозный комплекс со всеми видами культурных заведений.",
                owned: 0,
                price: 50000000,
                minLevel: 6
            }
        };

        // Инициализация игры
        function initGame() {
            loadGame();
            updateUI();
            renderBusinessList();
            setupModal();
            
            // Инициализация синхронизации
            initSync();
        }

        // Инициализация синхронизации между вкладками
        function initSync() {
            // Проверяем, есть ли лидер
            tryBecomeLeader();
            
            // Периодически проверяем, можем ли стать лидером
            setInterval(tryBecomeLeader, 10000);
            
            // Синхронизация данных каждые 1.5 секунды
            setInterval(() => {
                const shared = JSON.parse(localStorage.getItem('raccoonClickerShared') || '{}');
                if (shared.lastUpdater !== tabId) {
                    coins = shared.coins ?? coins;
                    cps = shared.cps ?? cps;
                    currentLevel = shared.currentLevel ?? currentLevel;
                    isFinalLevel = shared.isFinalLevel ?? isFinalLevel;
                    
                    // Обновляем бизнесы из общего хранилища
                    const businessData = JSON.parse(localStorage.getItem('raccoonBusinessData') || '{}');
                    for (const key in businesses) {
                        if (businessData[key]) {
                            businesses[key].owned = businessData[key].owned ?? 0;
                            businesses[key].price = businessData[key].price ?? businesses[key].basePrice;
                        }
                    }
                    
                    updateUI();
                    renderBusinessList();
                }
            }, 1500);
        }

        // Попытка стать лидером синхронизации
        function tryBecomeLeader() {
            const now = Date.now();
            const leader = JSON.parse(localStorage.getItem('incomeLeader') || '{}');
            if (!leader.timestamp || now - leader.timestamp > 20000) {
                localStorage.setItem('incomeLeader', JSON.stringify({ tabId, timestamp: now }));
            }
        }

        // Настройка модального окна
        function setupModal() {
            const modal = document.getElementById('business-modal');
            const openBtn = document.getElementById('open-business-modal');
            const closeBtn = document.getElementById('close-modal');
            
            openBtn.addEventListener('click', function() {
                renderBusinessOffers();
                modal.classList.add('active');
            });
            
            closeBtn.addEventListener('click', function() {
                modal.classList.remove('active');
            });
            
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.classList.remove('active');
                }
            });
        }

        // Рендер списка доступных бизнесов для покупки
        function renderBusinessOffers() {
            const container = document.getElementById('business-offers');
            container.innerHTML = '';
            
            for (const key in businesses) {
                const business = businesses[key];
                
                // Проверяем, доступен ли бизнес для текущего уровня
                if (business.minLevel && currentLevel < business.minLevel) continue;
                
                const businessElement = document.createElement('div');
                businessElement.className = `business-card business-item bg-white p-4 rounded-lg border border-gray-200 animate-slide-in`;
                
                businessElement.innerHTML = `
                    <div class="flex items-start">
                        <div class="flex-shrink-0 ${business.color} p-3 rounded-lg">
                            <i class="${business.icon} text-xl"></i>
                        </div>
                        <div class="ml-4 flex-1">
                            <h3 class="text-sm font-medium text-gray-800">${business.name}</h3>
                            <p class="mt-1 text-xs text-gray-500">${business.description}</p>
                            <div class="mt-3">
                                <div class="flex justify-between items-center mb-1">
                                    <span class="text-xs text-gray-600">Доход:</span>
                                    <span class="text-xs font-semibold text-green-600">+${business.baseIncome} RCC/15 сек</span>
                                </div>
                                <div class="flex justify-between items-center">
                                    <span class="text-xs text-gray-600">Цена:</span>
                                    <span class="text-xs font-semibold">${formatNumber(business.price)} RCC</span>
                                </div>
                            </div>
                            <div class="mt-3 flex justify-end">
                                <button onclick="buyBusiness('${key}')" class="bg-green-500 hover:bg-green-600 text-white px-3 py-1 rounded-full text-xs font-medium transition">
                                    Купить
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                container.appendChild(businessElement);
            }
        }

        // Рендер списка купленных бизнесов
        function renderBusinessList() {
            const container = document.getElementById('business-list');
            container.innerHTML = '';
            
            let hasBusinesses = false;
            
            for (const key in businesses) {
                const business = businesses[key];
                
                if (business.owned > 0) {
                    hasBusinesses = true;
                    
                    const businessElement = document.createElement('div');
                    businessElement.className = `business-card business-item bg-white p-4 rounded-lg border border-gray-200 animate-slide-in`;
                    
                    businessElement.innerHTML = `
                        <div class="flex items-start">
                            <div class="flex-shrink-0 ${business.color} p-3 rounded-lg">
                                <i class="${business.icon} text-xl"></i>
                            </div>
                            <div class="ml-4 flex-1">
                                <h3 class="text-sm font-medium text-gray-800">${business.name}</h3>
                                <p class="mt-1 text-xs text-gray-500">${business.owned} шт.</p>
                                <div class="mt-3">
                                    <div class="flex justify-between items-center mb-1">
                                        <span class="text-xs text-gray-600">Доход:</span>
                                        <span class="text-xs font-semibold text-green-600">+${business.baseIncome * business.owned} RCC/15 сек</span>
                                    </div>
                                    <div class="flex justify-between items-center">
                                        <span class="text-xs text-gray-600">Следующая цена:</span>
                                        <span class="text-xs font-semibold">${formatNumber(business.price)} RCC</span>
                                    </div>
                                </div>
                                <div class="mt-3 flex justify-end">
                                    <button onclick="buyBusiness('${key}')" class="bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded-full text-xs font-medium transition">
                                        Купить еще
                                    </button>
                                </div>
                            </div>
                        </div>
                    `;
                    
                    container.appendChild(businessElement);
                }
            }
            
            if (!hasBusinesses) {
                container.innerHTML = `
                    <div class="col-span-full text-center py-8">
                        <i class="fas fa-store-alt text-4xl text-gray-300 mb-4"></i>
                        <h3 class="text-lg font-medium text-gray-500">У вас пока нет бизнеса</h3>
                        <p class="text-sm text-gray-400 mt-2">Нажмите "Открыть бизнес", чтобы купить первое заведение</p>
                    </div>
                `;
            }
        }

        // Покупка бизнеса
        function buyBusiness(businessKey) {
            const business = businesses[businessKey];
            
            if (coins >= business.price) {
                coins -= business.price;
                business.owned += 1;
                
                // Увеличиваем цену для следующей покупки (на 20%)
                business.price = Math.floor(business.price * 1.2);
                
                // Рассчитываем новый доход
                calculateIncome();
                
                // Обновляем UI
                updateUI();
                renderBusinessList();
                saveGame();
                
                // Показываем уведомление
                showNotification(`Вы купили ${business.name}! Доход: +${business.baseIncome} RCC/15 сек`, 'green');
                
                // Если это было в модальном окне, обновляем предложения
                if (document.getElementById('business-modal').classList.contains('active')) {
                    renderBusinessOffers();
                }
            } else {
                showNotification('Не хватает RCC для покупки!', 'red');
            }
        }

        // Расчет общего дохода
        function calculateIncome() {
            let businessIncome = 0;
            for (const key in businesses) {
                businessIncome += businesses[key].baseIncome * businesses[key].owned;
            }
            
            // Получаем доход от кликов из общего хранилища
            const sharedData = JSON.parse(localStorage.getItem('raccoonClickerShared') || '{}');
            const clickIncome = sharedData.clickIncome || 0;

            
            // Общий доход (клики + бизнес)
            cps = clickIncome + businessIncome;
        }

        // Показать уведомление
        function showNotification(message, color = 'blue') {
            const colors = {
                blue: 'bg-blue-100 border-blue-400 text-blue-800',
                green: 'bg-green-100 border-green-400 text-green-800',
                red: 'bg-red-100 border-red-400 text-red-800'
            };
            
            const notification = document.createElement('div');
            notification.className = `fixed top-4 left-1/2 transform -translate-x-1/2 ${colors[color]} border px-6 py-3 rounded-lg shadow-lg z-50 notification`;
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="fas fa-info-circle mr-2"></i>
                    <span>${message}</span>
                </div>
            `;
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Обновление интерфейса
        function updateUI() {
            // Основные показатели
            document.getElementById('coins').textContent = formatNumber(Math.floor(coins));
            document.getElementById('cps').textContent = formatNumber(cps.toFixed(1));
            
            // Прогресс бар
            let progressPercent;
            if (currentLevel <= 6) {
                progressPercent = Math.min((coins / currentTarget) * 100, 100);
                document.getElementById('current-progress').textContent = formatNumber(Math.floor(coins));
                document.getElementById('target').textContent = formatNumber(currentTarget);
            } else {
                // После 6 уровня показываем только текущее количество RCC
                progressPercent = 100;
                document.getElementById('current-progress').textContent = formatNumber(Math.floor(coins));
                document.getElementById('target').textContent = "∞";
            }
            
            document.getElementById('progress-bar').style.width = `${progressPercent}%`;
            
            // Обновляем бейдж уровня
            document.getElementById('current-level').textContent = currentLevel;
        }

        // Форматирование чисел с разделителями
        function formatNumber(num) {
            return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, " ");
        }

        // Сохранение игры
        function saveGame() {
            try {
                // Сохраняем данные бизнеса
                const businessData = {};
                for (const key in businesses) {
                    businessData[key] = {
                        owned: businesses[key].owned,
                        price: businesses[key].price
                    };
                }
                localStorage.setItem('raccoonBusinessData', JSON.stringify(businessData));
                
                // Рассчитываем доход от бизнеса
                let businessIncome = 0;
                for (const key in businesses) {
                    businessIncome += businesses[key].baseIncome * businesses[key].owned;
                }
                
                // Обновляем общие данные
                const shared = JSON.parse(localStorage.getItem('raccoonClickerShared') || '{}');
                shared.coins = coins;
                shared.businessIncome = businessIncome;
                shared.currentLevel = currentLevel;
                shared.isFinalLevel = isFinalLevel;
                shared.timestamp = Date.now();
                shared.lastUpdater = tabId;
                
                localStorage.setItem('raccoonClickerShared', JSON.stringify(shared));
                
                lastSaveTime = Date.now();
            } catch (e) {
                console.warn("Ошибка сохранения:", e);
            }
        }

        // Загрузка игры
        function loadGame() {
            // Загружаем общие данные
            const sharedData = JSON.parse(localStorage.getItem('raccoonClickerShared') || '{}');
            coins = sharedData.coins || 0;
            currentLevel = sharedData.currentLevel || 1;
            currentTarget = levelTargets[currentLevel - 1] || levelTargets[0];
            isFinalLevel = sharedData.isFinalLevel || false;
            lastSaveTime = sharedData.timestamp || Date.now();
            
            // Загружаем данные бизнеса
            const businessData = JSON.parse(localStorage.getItem('raccoonBusinessData') || '{}');
            for (const key in businesses) {
                if (businessData[key]) {
                    businesses[key].owned = businessData[key].owned || 0;
                    businesses[key].price = businessData[key].price || businesses[key].basePrice;
                }
            }
            
            // Рассчитываем доход только если есть улучшения
            if (sharedData.cps) {
                calculateIncome();
            } else {
                cps = 0;
            }
            
            // Проверяем оффлайн прогресс
            checkOfflineProgress(lastSaveTime);
        }

        // Проверка оффлайн прогресса
        function checkOfflineProgress(lastSave) {
            const now = Date.now();
            const offlineTime = Math.floor((now - lastSave) / 1000); // В секундах
            
            if (offlineTime > 5 && cps > 0) { // Показываем только если оффлайн был больше 5 секунд и есть доход
                // Максимальное время оффлайн прогресса - 24 часа
                const maxOfflineTime = 24 * 60 * 60; // 24 часа в секундах
                const actualOfflineTime = Math.min(offlineTime, maxOfflineTime);
                
                // Рассчитываем заработанные RCC (каждые 15 секунд)
                const earnedRCC = Math.floor(cps * (actualOfflineTime / 15));
                
                if (earnedRCC > 0) {
                    // Добавляем заработанные RCC
                    coins += earnedRCC;
                    
                    // Показываем уведомление об оффлайн прогрессе
                    const offlineProgress = document.createElement('div');
                    offlineProgress.className = 'fixed bottom-4 right-4 bg-black/70 text-white px-4 py-3 rounded-lg z-50 animate-slide-in';
                    
                    offlineProgress.innerHTML = `
                        <div class="flex items-center">
                            <i class="fas fa-clock mr-2"></i>
                            <span>${formatTime(actualOfflineTime)} оффлайн</span>
                        </div>
                        <div class="mt-1 text-sm">
                            Получено <span class="font-bold">${formatNumber(earnedRCC)} RCC</span>
                        </div>
                    `;
                    
                    document.body.appendChild(offlineProgress);
                    
                    // Скрываем через 5 секунд
                    setTimeout(() => {
                        offlineProgress.remove();
                    }, 5000);
                    
                    updateUI();
                    saveGame();
                }
            }
        }

        // Форматирование времени для оффлайн прогресса
        function formatTime(seconds) {
            if (seconds < 60) {
                return `${seconds} секунд`;
            } else if (seconds < 3600) {
                const minutes = Math.floor(seconds / 60);
                return `${minutes} минут`;
            } else {
                const hours = Math.floor(seconds / 3600);
                return `${hours} часов`;
            }
        }

        // Автоматическое сохранение каждые 30 секунд
        setInterval(() => {
            saveGame();
        }, 30000);

        // Инициализация при загрузке страницы
        window.onload = function() {
            initGame();
        };

        // Сохраняем игру при закрытии вкладка
        window.addEventListener('beforeunload', function(e) {
            saveGame();
        });

        // Обработчик видимости страницы
        document.addEventListener('visibilitychange', function() {
            if (document.visibilityState === 'visible') {
                // Страница снова стала видимой - проверяем оффлайн прогресс
                const sharedData = JSON.parse(localStorage.getItem('raccoonClickerShared') || '{}');
                checkOfflineProgress(sharedData.timestamp || Date.now());
            } else {
                // Страница стала невидимой - сохраняем игру
                saveGame();
            }
        });
    </script>
</body>
</html>